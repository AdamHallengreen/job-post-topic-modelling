schema: '2.0'
stages:
  prepare:
    cmd: python src/job_post_topic_modelling/prepare.py
    deps:
    - path: data/Jobnet.xlsx
      hash: md5
      md5: 26964e5ea3bf422d0f744b6fab9af448
      size: 13307578
    - path: src/job_post_topic_modelling/prepare.py
      hash: md5
      md5: a565937eb545f0695bae7db6905186a1
      size: 10609
    - path: src/job_post_topic_modelling/utils/data_io.py
      hash: md5
      md5: 6eee0ff02eb398221fb21b4faff63a43
      size: 1248
    - path: src/job_post_topic_modelling/utils/find_project_root.py
      hash: md5
      md5: 865c2bda4ba114cec5b1b69baadf5a6f
      size: 3412
    params:
      params.yaml:
        prepare:
          settings:
            nobs:
            split_paragraphs: true
            split_sentences: false
          star:
            usestar: 0
    outs:
    - path: data/texts.parquet
      hash: md5
      md5: 9e849442e5c16a27385d5fbc14839f9e
      size: 6948540
  train:
    cmd: python src/job_post_topic_modelling/train.py
    deps:
    - path: data/embeddings.npy
      hash: md5
      md5: b712c135fae1cfd48ecbb97cca9a5bf3
      size: 391907456
    - path: data/texts.parquet
      hash: md5
      md5: 9e849442e5c16a27385d5fbc14839f9e
      size: 6948540
    - path: src/job_post_topic_modelling/train.py
      hash: md5
      md5: ec6f91fc568573f76ca323f027e1538b
      size: 6525
    - path: src/job_post_topic_modelling/utils/data_io.py
      hash: md5
      md5: 6eee0ff02eb398221fb21b4faff63a43
      size: 1248
    - path: src/job_post_topic_modelling/utils/find_project_root.py
      hash: md5
      md5: 865c2bda4ba114cec5b1b69baadf5a6f
      size: 3412
    params:
      params.yaml:
        embed:
          settings:
            show_progress_bar: true
            batch_size: 256
            device: cpu
            num_workers: 1
          model:
            embedding_model: 
              sentence-transformers/paraphrase-multilingual-mpnet-base-v2
            use_model2vec: false
            pca_dims: 384
        train:
          settings:
            top_n_words: 20
            calculate_probabilities: false
            nr_topics:
            verbose: true
          seed_topics:
            seeds:
          dimensionality_reduction:
            model: UMAP
            n_neighbors: 60
            n_components: 5
            min_dist: 0.0
            metric: cosine
            random_state:
            low_memory: true
          clustering:
            model: HDBSCAN
            min_cluster_size: 1000
            min_samples: 500
            metric: euclidean
            cluster_selection_method: leaf
            prediction_data: false
    outs:
    - path: models/bertopic_model/config.json
      hash: md5
      md5: 4d368c646fac706e9910da61b1412f12
      size: 396
    - path: models/bertopic_model/topic_embeddings.safetensors
      hash: md5
      md5: 4590f3dcc0cb84314d03719ef456df2e
      size: 52312
    - path: models/bertopic_model/topics.json
      hash: md5
      md5: 63c46c62a19f9e789914695838da5463
      size: 1129680
  predict:
    cmd: python src/job_post_topic_modelling/predict.py
    deps:
    - path: data/embeddings.npy
      hash: md5
      md5: 0180390272666730ce3b41a1df624dd8
      size: 83521664
    - path: data/texts.parquet
      hash: md5
      md5: c1add3c5a40f90d38209604b8f6c2f0e
      size: 811802
    - path: src/job_post_topic_modelling/predict.py
      hash: md5
      md5: 87ed9625ae361f3dea75b5020d3c05a0
      size: 5999
    - path: src/job_post_topic_modelling/utils/data_io.py
      hash: md5
      md5: a50681cf3a6b5f5e8715270a598f9357
      size: 952
    - path: src/job_post_topic_modelling/utils/find_project_root.py
      hash: md5
      md5: 865c2bda4ba114cec5b1b69baadf5a6f
      size: 3412
    params:
      params.yaml:
        embed:
          settings:
            show_progress_bar: true
            batch_size: 256
            device: cpu
            num_workers: 1
          model:
            embedding_model: intfloat/multilingual-e5-large-instruct
        predict:
          settings:
            top_n_words: 20
            verbose: true
          dimensionality_reduction:
            model: UMAP
            n_neighbors: 15
            n_components: 5
            min_dist: 0.0
            metric: cosine
            random_state: 42
          clustering:
            model: HDBSCAN
            min_cluster_size: 15
            min_samples: 15
            metric: euclidean
            cluster_selection_method: eom
            prediction_data: true
          vectorizer:
            model: CountVectorizer
            ngram_range:
            - 1
            - 3
            min_df: 10
            max_features: 10000
          c_TF_IDF:
            model: c_TF_IDF
            bm25_weighting: true
            reduce_frequent_words: true
          representation:
            model: KeyBERTInspired
    outs:
    - path: models/bertopic_model/config.json
      hash: md5
      md5: 8a0e79a5488a615175aa10b4690ea527
      size: 376
    - path: models/bertopic_model/topic_embeddings.safetensors
      hash: md5
      md5: c53913eb8f32bb3bbdc1b3fbafa45579
      size: 942176
    - path: models/bertopic_model/topics.json
      hash: md5
      md5: f625436e6b93e770bd887267a6fa0792
      size: 366532
  evaluate:
    cmd: python src/job_post_topic_modelling/evaluate.py
    deps:
    - path: data/reduced_embeddings.npy
      hash: md5
      md5: a1ce1cd60c61ece70e0a093ec1aad2e0
      size: 1020720
    - path: models/bertopic_model/config.json
      hash: md5
      md5: 4d368c646fac706e9910da61b1412f12
      size: 396
    - path: models/bertopic_model/topic_embeddings.safetensors
      hash: md5
      md5: 4590f3dcc0cb84314d03719ef456df2e
      size: 52312
    - path: models/bertopic_model/topics.json
      hash: md5
      md5: 63c46c62a19f9e789914695838da5463
      size: 1129680
    - path: src/job_post_topic_modelling/evaluate.py
      hash: md5
      md5: f79e9d3400736cde33941951c38a5897
      size: 6294
    - path: src/job_post_topic_modelling/utils/data_io.py
      hash: md5
      md5: 6eee0ff02eb398221fb21b4faff63a43
      size: 1248
    - path: src/job_post_topic_modelling/utils/find_project_root.py
      hash: md5
      md5: 865c2bda4ba114cec5b1b69baadf5a6f
      size: 3412
    - path: src/job_post_topic_modelling/utils/log_html.py
      hash: md5
      md5: 7ed83b949012708be661325d24235c5b
      size: 955
    outs:
    - path: output/topic_info.csv
      hash: md5
      md5: 3b36b8e9d2d78eb9a071ccc422047ec9
      size: 3677
  embed:
    cmd: python src/job_post_topic_modelling/embed.py
    deps:
    - path: data/texts.parquet
      hash: md5
      md5: 9e849442e5c16a27385d5fbc14839f9e
      size: 6948540
    - path: src/job_post_topic_modelling/embed.py
      hash: md5
      md5: affd81d6ded83620e8173a9f5ea2314f
      size: 2392
    - path: src/job_post_topic_modelling/utils/data_io.py
      hash: md5
      md5: 6eee0ff02eb398221fb21b4faff63a43
      size: 1248
    - path: src/job_post_topic_modelling/utils/find_project_root.py
      hash: md5
      md5: 865c2bda4ba114cec5b1b69baadf5a6f
      size: 3412
    params:
      params.yaml:
        embed:
          settings:
            show_progress_bar: true
            batch_size: 256
            device: cpu
            num_workers: 1
          model:
            embedding_model: 
              sentence-transformers/paraphrase-multilingual-mpnet-base-v2
            use_model2vec: false
            pca_dims: 384
    outs:
    - path: data/embeddings.npy
      hash: md5
      md5: b712c135fae1cfd48ecbb97cca9a5bf3
      size: 391907456
    - path: data/reduced_embeddings.npy
      hash: md5
      md5: a1ce1cd60c61ece70e0a093ec1aad2e0
      size: 1020720
