schema: '2.0'
stages:
  prepare:
    cmd: python src/job_post_topic_modelling/prepare.py
    deps:
    - path: data/Jobnet.xlsx
      hash: md5
      md5: 26964e5ea3bf422d0f744b6fab9af448
      size: 13307578
    - path: src/job_post_topic_modelling/prepare.py
      hash: md5
      md5: 535ccee487623be352c758465a23b7fb
      size: 10554
    - path: src/job_post_topic_modelling/utils/data_io.py
      hash: md5
      md5: ce241e37484d0b8e4f95d941bcc936fc
      size: 1313
    - path: src/job_post_topic_modelling/utils/find_project_root.py
      hash: md5
      md5: 865c2bda4ba114cec5b1b69baadf5a6f
      size: 3412
    params:
      params.yaml:
        prepare:
          settings:
            nobs:
            split_paragraphs: true
            split_sentences: false
          star:
            usestar: 0
    outs:
    - path: data/texts.parquet
      hash: md5
      md5: 9e849442e5c16a27385d5fbc14839f9e
      size: 6948540
  train:
    cmd: python src/job_post_topic_modelling/train.py
    deps:
    - path: data/embeddings.npy
      hash: md5
      md5: b712c135fae1cfd48ecbb97cca9a5bf3
      size: 391907456
    - path: data/texts.parquet
      hash: md5
      md5: 9e849442e5c16a27385d5fbc14839f9e
      size: 6948540
    - path: src/job_post_topic_modelling/train.py
      hash: md5
      md5: 22833b8613d11dfb2b093401a2728bae
      size: 6195
    - path: src/job_post_topic_modelling/utils/data_io.py
      hash: md5
      md5: ce241e37484d0b8e4f95d941bcc936fc
      size: 1313
    - path: src/job_post_topic_modelling/utils/find_project_root.py
      hash: md5
      md5: 865c2bda4ba114cec5b1b69baadf5a6f
      size: 3412
    params:
      params.yaml:
        embed:
          settings:
            show_progress_bar: true
            batch_size: 256
            device: cpu
            num_workers: 1
          model:
            embedding_model: 
              sentence-transformers/paraphrase-multilingual-mpnet-base-v2
            use_model2vec: false
            pca_dims: 384
        train:
          settings:
            top_n_words: 20
            calculate_probabilities: false
            verbose: true
          seed_topics:
            seeds:
            - - fleksibel
              - fleksibilitet
              - fleksibel arbejdstid
              - fleksibel arbejdstid
              - flekstid
              - flekstidsordning
              - flextid
              - flextidsordning
              - fixtid
              - fikstid
            - - familievenlig
              - familievenlige
              - familieliv
            - - hjemmearbejde
              - hjemmearbejdsplads
              - hjemmearbejdsdag
              - hjemmefra
            - - vagtskema
              - vagtplan
              - spidsbelastning
            - - natarbejde
              - weekend
              - weekendarbejde
              - helligdage
              - nattevagt
              - nattevagte
              - nattevagterne
              - aften
            - - ambitiøs
              - ambition
              - udvikling
              - karriere
              - udviklingsmuligheder
              - udviklingsplaner
              - udviklingsforløb
              - udviklingsprogram
            - - faglig
              - faglighed
              - sparring
            - - stillingen
              - samtaler
              - snarest muligt
              - mulig
              - ansøgning
              - ringe
              - ansøgning mail
              - ansøgning
              - sende
              - cv
              - sende ansøgning
              - ansøgning cv
              - send
              - send ansøgning
              - ansøgning sende
              - modtage ansøgning
            - - køn
              - etnisk
              - religion
              - religion etnisk
              - uanset alder
              - alder køn
              - etnisk tilhørsforhold
              - tilhørsforhold
            - - mandag
              - tirsdag
              - onsdag
              - torsdag
              - fredag
              - lørdag
              - søndag
            - - finansministeri
              - overenskomst
              - overenskomst finansministeri
              - gældende
            - - rengøringsvogn
            - - orlov
              - ferie
              - feriefridage
              - sygeorlov
              - barselsorlov
            - - bonus
              - provision
              - incitamenter
              - præstationsløn
              - salgsbonus
              - mål
              - produktivitet
            - - sundhedsforsikring
              - helbredsforsikring
              - sygeforsikring
              - sundhedsordning
              - privathospital
            - - pension
              - pensionsordning
              - arbejdsmarkedspension
              - pensionsbidrag
              - pensionsaftale
            - - kantine
              - kantineordning
              - frokostordning
              - personalekøb
            - - fitnessrum
              - kaffebar
              - ergonomisk
              - kontorfaciliteter
            - - bærbar
              - mobiltelefon
              - dataabonnement
              - værktøj
              - værnemidler
            - - sikkerhed
              - værnemidler
              - fare
              - compliance
              - sikkerhedstræning
            - - fastansættelse
              - fuldtid
              - stabilitet
              - langtidskontrakt
              - jobsikkerhed
              - anciennitet
              - tidsubegrænset
            - - tidsbegrænset
              - projektansættelse
              - midlertidig
              - midlertidigansættelse
              - prøvetidsansættelse
              - vikariat
              - kontraktansættelse
              - praktik
            - - kultur
              - værdier
              - inklusion
              - diversitet
              - bæredygtighed
              - samfundsindsats
            - - tungt
              - fysisk
              - fysiskarbejde
              - manuelt
              - anstrengende
            - - teamarbejde
              - team
              - samarbejde
              - kolleger
              - tværfaglig
              - hold
            - - uddannelse
              - læring
              - udvikling
              - karrierevækst
              - opkvalificering
              - mentoring
              - kurser
            - - sundhed
              - pleje
              - sygehus
              - klinik
            - - byggeri
              - håndværker
              - tømrer
              - murer
            - - detailhandel
              - butik
              - ekspedient
              - kasse
            - - logistik
              - lager
              - chauffør
              - truck
            - - it
              - softwareudvikler
              - programmering
              - udvikler
            - - finans
              - regnskab
              - bogholder
              - controller
            - - produktion
              - fabrik
              - montage
              - operatør
            - - uddannelse
              - lærer
              - undervisning
              - pædagog
            - - hospitality
              - restaurant
              - kok
              - tjener
            - - offentlig
              - kommune
              - rådhus
              - forvaltning
              - myndighed
              - fuldmægtig
              - ministerium
              - departement
              - styrelse
            - - kirke
              - sogn
              - menighedsråd
            - - militær
              - forsvar
              - soldat
              - officer
              - forsvarsministeri
            - - projektleder
              - projektstyring
              - planlægning
              - koordinere
            - - konsulent
              - rådgiver
              - analyse
              - implementering
            - - sosuassistent
              - social sundhedsassistent
              - pleje
              - borgerkontakt
            - - sygeplejerske
              - patient
              - klinisk
              - journal
            - - ingeniør
              - konstruktion
              - design
              - beregning
            - - elektriker
              - installation
              - fejlfinding
              - serviceopgaver
            - - kundeservicemedarbejder
              - support
              - telefon
              - kundehenvendelser
            - - maskinoperatør
              - produktion
              - vedligehold
              - skiftehold
            - - økonom
              - budget
              - controlling
              - afstemning
            - - jurist
              - kontrakt
              - lovgivning
              - compliance
            - - pædagog
              - børnehave
              - skole
              - undervisning
            name: flex1
            anchor_strength: 6
          dimensionality_reduction:
            model: UMAP
            n_neighbors: 60
            n_components: 5
            min_dist: 0.0
            metric: cosine
            random_state: 42
          clustering:
            model: HDBSCAN
            min_cluster_size: 120
            min_samples: 30
            metric: euclidean
            cluster_selection_method: eom
            prediction_data: true
    outs:
    - path: models/bertopic_model/config.json
      hash: md5
      md5: f87673d15e1304b55628f4ac39c5690c
      size: 6705
    - path: models/bertopic_model/topic_embeddings.safetensors
      hash: md5
      md5: ce1c1c35631ef50433c2c9498a853897
      size: 331864
    - path: models/bertopic_model/topics.json
      hash: md5
      md5: bc4323b8f6b4f092d95a7efb40536898
      size: 1278555
  predict:
    cmd: python src/job_post_topic_modelling/predict.py
    deps:
    - path: data/embeddings.npy
      hash: md5
      md5: 0180390272666730ce3b41a1df624dd8
      size: 83521664
    - path: data/texts.parquet
      hash: md5
      md5: c1add3c5a40f90d38209604b8f6c2f0e
      size: 811802
    - path: src/job_post_topic_modelling/predict.py
      hash: md5
      md5: 87ed9625ae361f3dea75b5020d3c05a0
      size: 5999
    - path: src/job_post_topic_modelling/utils/data_io.py
      hash: md5
      md5: a50681cf3a6b5f5e8715270a598f9357
      size: 952
    - path: src/job_post_topic_modelling/utils/find_project_root.py
      hash: md5
      md5: 865c2bda4ba114cec5b1b69baadf5a6f
      size: 3412
    params:
      params.yaml:
        embed:
          settings:
            show_progress_bar: true
            batch_size: 256
            device: cpu
            num_workers: 1
          model:
            embedding_model: intfloat/multilingual-e5-large-instruct
        predict:
          settings:
            top_n_words: 20
            verbose: true
          dimensionality_reduction:
            model: UMAP
            n_neighbors: 15
            n_components: 5
            min_dist: 0.0
            metric: cosine
            random_state: 42
          clustering:
            model: HDBSCAN
            min_cluster_size: 15
            min_samples: 15
            metric: euclidean
            cluster_selection_method: eom
            prediction_data: true
          vectorizer:
            model: CountVectorizer
            ngram_range:
            - 1
            - 3
            min_df: 10
            max_features: 10000
          c_TF_IDF:
            model: c_TF_IDF
            bm25_weighting: true
            reduce_frequent_words: true
          representation:
            model: KeyBERTInspired
    outs:
    - path: models/bertopic_model/config.json
      hash: md5
      md5: 8a0e79a5488a615175aa10b4690ea527
      size: 376
    - path: models/bertopic_model/topic_embeddings.safetensors
      hash: md5
      md5: c53913eb8f32bb3bbdc1b3fbafa45579
      size: 942176
    - path: models/bertopic_model/topics.json
      hash: md5
      md5: f625436e6b93e770bd887267a6fa0792
      size: 366532
  evaluate:
    cmd: python src/job_post_topic_modelling/evaluate.py
    deps:
    - path: data/reduced_embeddings.npy
      hash: md5
      md5: 2f13e4762bd2f049a75478ff908a9777
      size: 1020720
    - path: models/bertopic_model/config.json
      hash: md5
      md5: f87673d15e1304b55628f4ac39c5690c
      size: 6705
    - path: models/bertopic_model/topic_embeddings.safetensors
      hash: md5
      md5: ce1c1c35631ef50433c2c9498a853897
      size: 331864
    - path: models/bertopic_model/topics.json
      hash: md5
      md5: bc4323b8f6b4f092d95a7efb40536898
      size: 1278555
    - path: src/job_post_topic_modelling/evaluate.py
      hash: md5
      md5: f1ce7a2da355b5ba0133a0a936d5f9f5
      size: 5820
    - path: src/job_post_topic_modelling/utils/data_io.py
      hash: md5
      md5: ce241e37484d0b8e4f95d941bcc936fc
      size: 1313
    - path: src/job_post_topic_modelling/utils/find_project_root.py
      hash: md5
      md5: 865c2bda4ba114cec5b1b69baadf5a6f
      size: 3412
    - path: src/job_post_topic_modelling/utils/log_html.py
      hash: md5
      md5: cb854d3d5d6febba8d4c04750e85924f
      size: 836
    outs:
    - path: output/topic_info.csv
      hash: md5
      md5: 56195258a5d13e35d690ff9b88245215
      size: 25969
  embed:
    cmd: python src/job_post_topic_modelling/embed.py
    deps:
    - path: data/texts.parquet
      hash: md5
      md5: 9e849442e5c16a27385d5fbc14839f9e
      size: 6948540
    - path: src/job_post_topic_modelling/embed.py
      hash: md5
      md5: 562ed19ece671d8b3248dedeff673bc9
      size: 2362
    - path: src/job_post_topic_modelling/utils/data_io.py
      hash: md5
      md5: ce241e37484d0b8e4f95d941bcc936fc
      size: 1313
    - path: src/job_post_topic_modelling/utils/find_project_root.py
      hash: md5
      md5: 865c2bda4ba114cec5b1b69baadf5a6f
      size: 3412
    params:
      params.yaml:
        embed:
          settings:
            show_progress_bar: true
            batch_size: 256
            device: cpu
            num_workers: 1
          model:
            embedding_model: 
              sentence-transformers/paraphrase-multilingual-mpnet-base-v2
            use_model2vec: false
            pca_dims: 384
    outs:
    - path: data/embeddings.npy
      hash: md5
      md5: b712c135fae1cfd48ecbb97cca9a5bf3
      size: 391907456
    - path: data/reduced_embeddings.npy
      hash: md5
      md5: 2f13e4762bd2f049a75478ff908a9777
      size: 1020720
