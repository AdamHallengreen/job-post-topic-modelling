schema: '2.0'
stages:
  prepare:
    cmd: python src/job_post_topic_modelling/prepare.py
    deps:
    - path: data/Jobnet.xlsx
      hash: md5
      md5: 26964e5ea3bf422d0f744b6fab9af448
      size: 13307578
    - path: src/job_post_topic_modelling/prepare.py
      hash: md5
      md5: 222036c9845d33a6c713050e68b7de6f
      size: 10885
    - path: src/job_post_topic_modelling/utils/data_io.py
      hash: md5
      md5: ce241e37484d0b8e4f95d941bcc936fc
      size: 1313
    - path: src/job_post_topic_modelling/utils/find_project_root.py
      hash: md5
      md5: 865c2bda4ba114cec5b1b69baadf5a6f
      size: 3412
    params:
      params.yaml:
        prepare:
          settings:
            nobs:
            split_paragraphs: true
            split_sentences: false
          star:
            usestar: 0
    outs:
    - path: data/texts.parquet
      hash: md5
      md5: 9e849442e5c16a27385d5fbc14839f9e
      size: 6948540
  train:
    cmd: python src/job_post_topic_modelling/train.py
    deps:
    - path: data/embeddings.npy
      hash: md5
      md5: b712c135fae1cfd48ecbb97cca9a5bf3
      size: 391907456
    - path: data/texts.parquet
      hash: md5
      md5: 9e849442e5c16a27385d5fbc14839f9e
      size: 6948540
    - path: src/job_post_topic_modelling/train.py
      hash: md5
      md5: 00e7eba2850fad04e8e6b288e502110f
      size: 6367
    - path: src/job_post_topic_modelling/utils/data_io.py
      hash: md5
      md5: ce241e37484d0b8e4f95d941bcc936fc
      size: 1313
    - path: src/job_post_topic_modelling/utils/find_project_root.py
      hash: md5
      md5: 865c2bda4ba114cec5b1b69baadf5a6f
      size: 3412
    params:
      params.yaml:
        embed:
          settings:
            show_progress_bar: true
            batch_size: 256
            device: cpu
            num_workers: 1
          model:
            embedding_model:
              sentence-transformers/paraphrase-multilingual-mpnet-base-v2
            use_model2vec: false
            pca_dims: 384
        train:
          settings:
            top_n_words: 20
            calculate_probabilities: false
            verbose: true
          seed_topics:
            seeds:
          dimensionality_reduction:
            model: UMAP
            n_neighbors: 60
            n_components: 5
            min_dist: 0.0
            metric: cosine
            random_state: 42
          clustering:
            model: HDBSCAN
            min_cluster_size: 120
            min_samples: 30
            metric: euclidean
            cluster_selection_method: eom
            prediction_data: true
    outs:
    - path: models/bertopic_model/config.json
      hash: md5
      md5: a619d92166a7c4e3b363b4ec5564505d
      size: 398
    - path: models/bertopic_model/topic_embeddings.safetensors
      hash: md5
      md5: c407dae7fb3e95826d3ee61c4a06122c
      size: 338008
    - path: models/bertopic_model/topics.json
      hash: md5
      md5: ead48c40c0088fbe4d75c8251c07b702
      size: 1279908
  predict:
    cmd: python src/job_post_topic_modelling/predict.py
    deps:
    - path: data/embeddings.npy
      hash: md5
      md5: 0180390272666730ce3b41a1df624dd8
      size: 83521664
    - path: data/texts.parquet
      hash: md5
      md5: c1add3c5a40f90d38209604b8f6c2f0e
      size: 811802
    - path: src/job_post_topic_modelling/predict.py
      hash: md5
      md5: 87ed9625ae361f3dea75b5020d3c05a0
      size: 5999
    - path: src/job_post_topic_modelling/utils/data_io.py
      hash: md5
      md5: a50681cf3a6b5f5e8715270a598f9357
      size: 952
    - path: src/job_post_topic_modelling/utils/find_project_root.py
      hash: md5
      md5: 865c2bda4ba114cec5b1b69baadf5a6f
      size: 3412
    params:
      params.yaml:
        embed:
          settings:
            show_progress_bar: true
            batch_size: 256
            device: cpu
            num_workers: 1
          model:
            embedding_model: intfloat/multilingual-e5-large-instruct
        predict:
          settings:
            top_n_words: 20
            verbose: true
          dimensionality_reduction:
            model: UMAP
            n_neighbors: 15
            n_components: 5
            min_dist: 0.0
            metric: cosine
            random_state: 42
          clustering:
            model: HDBSCAN
            min_cluster_size: 15
            min_samples: 15
            metric: euclidean
            cluster_selection_method: eom
            prediction_data: true
          vectorizer:
            model: CountVectorizer
            ngram_range:
            - 1
            - 3
            min_df: 10
            max_features: 10000
          c_TF_IDF:
            model: c_TF_IDF
            bm25_weighting: true
            reduce_frequent_words: true
          representation:
            model: KeyBERTInspired
    outs:
    - path: models/bertopic_model/config.json
      hash: md5
      md5: 8a0e79a5488a615175aa10b4690ea527
      size: 376
    - path: models/bertopic_model/topic_embeddings.safetensors
      hash: md5
      md5: c53913eb8f32bb3bbdc1b3fbafa45579
      size: 942176
    - path: models/bertopic_model/topics.json
      hash: md5
      md5: f625436e6b93e770bd887267a6fa0792
      size: 366532
  evaluate:
    cmd: python src/job_post_topic_modelling/evaluate.py
    deps:
    - path: data/reduced_embeddings.npy
      hash: md5
      md5: e115c8a353c343958afbe9469a4ea03b
      size: 1020720
    - path: models/bertopic_model/config.json
      hash: md5
      md5: a619d92166a7c4e3b363b4ec5564505d
      size: 398
    - path: models/bertopic_model/topic_embeddings.safetensors
      hash: md5
      md5: c407dae7fb3e95826d3ee61c4a06122c
      size: 338008
    - path: models/bertopic_model/topics.json
      hash: md5
      md5: ead48c40c0088fbe4d75c8251c07b702
      size: 1279908
    - path: src/job_post_topic_modelling/evaluate.py
      hash: md5
      md5: ace4f5969d9ad53d1778e319eece49ae
      size: 5990
    - path: src/job_post_topic_modelling/utils/data_io.py
      hash: md5
      md5: ce241e37484d0b8e4f95d941bcc936fc
      size: 1313
    - path: src/job_post_topic_modelling/utils/find_project_root.py
      hash: md5
      md5: 865c2bda4ba114cec5b1b69baadf5a6f
      size: 3412
    - path: src/job_post_topic_modelling/utils/log_html.py
      hash: md5
      md5: 763aaa1772dd5a56d3095d27b10a3ccf
      size: 863
    outs:
    - path: output/topic_info.csv
      hash: md5
      md5: e83b817307383c5fd3ab15a2dbaf4060
      size: 26628
  embed:
    cmd: python src/job_post_topic_modelling/embed.py
    deps:
    - path: data/texts.parquet
      hash: md5
      md5: 9e849442e5c16a27385d5fbc14839f9e
      size: 6948540
    - path: src/job_post_topic_modelling/embed.py
      hash: md5
      md5: 1c84836121efe71a5073a11f99973262
      size: 2430
    - path: src/job_post_topic_modelling/utils/data_io.py
      hash: md5
      md5: ce241e37484d0b8e4f95d941bcc936fc
      size: 1313
    - path: src/job_post_topic_modelling/utils/find_project_root.py
      hash: md5
      md5: 865c2bda4ba114cec5b1b69baadf5a6f
      size: 3412
    params:
      params.yaml:
        embed:
          settings:
            show_progress_bar: true
            batch_size: 256
            device: cpu
            num_workers: 1
          model:
            embedding_model:
              sentence-transformers/paraphrase-multilingual-mpnet-base-v2
            use_model2vec: false
            pca_dims: 384
    outs:
    - path: data/embeddings.npy
      hash: md5
      md5: b712c135fae1cfd48ecbb97cca9a5bf3
      size: 391907456
    - path: data/reduced_embeddings.npy
      hash: md5
      md5: e115c8a353c343958afbe9469a4ea03b
      size: 1020720
