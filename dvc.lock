schema: '2.0'
stages:
  prepare:
    cmd: python src/job_post_topic_modelling/prepare.py
    deps:
    - path: data/Jobnet.xlsx
      hash: md5
      md5: 26964e5ea3bf422d0f744b6fab9af448
      size: 13307578
    - path: src/job_post_topic_modelling/prepare.py
      hash: md5
      md5: 0887fcdc070c3e5033145eb354ff17ba
      size: 10184
    - path: src/job_post_topic_modelling/utils/data_io.py
      hash: md5
      md5: ce241e37484d0b8e4f95d941bcc936fc
      size: 1313
    - path: src/job_post_topic_modelling/utils/find_project_root.py
      hash: md5
      md5: 865c2bda4ba114cec5b1b69baadf5a6f
      size: 3412
    params:
      params.yaml:
        prepare:
          settings:
            nobs:
            split_paragraphs: true
          star:
            usestar: 0
    outs:
    - path: data/texts.parquet
      hash: md5
      md5: 9e849442e5c16a27385d5fbc14839f9e
      size: 6948540
  train:
    cmd: python src/job_post_topic_modelling/train.py
    deps:
    - path: data/embeddings.npy
      hash: md5
      md5: b712c135fae1cfd48ecbb97cca9a5bf3
      size: 391907456
    - path: data/texts.parquet
      hash: md5
      md5: 9e849442e5c16a27385d5fbc14839f9e
      size: 6948540
    - path: src/job_post_topic_modelling/train.py
      hash: md5
      md5: b4e9aa08bf0fd551e6e45b059051c89d
      size: 5336
    - path: src/job_post_topic_modelling/utils/data_io.py
      hash: md5
      md5: ce241e37484d0b8e4f95d941bcc936fc
      size: 1313
    - path: src/job_post_topic_modelling/utils/find_project_root.py
      hash: md5
      md5: 865c2bda4ba114cec5b1b69baadf5a6f
      size: 3412
    params:
      params.yaml:
        embed:
          settings:
            show_progress_bar: true
            batch_size: 256
            device: cpu
            num_workers: 1
          model:
            embedding_model:
              sentence-transformers/paraphrase-multilingual-mpnet-base-v2
            use_model2vec: false
            pca_dims: 384
        train:
          settings:
            top_n_words: 20
            verbose: true
          dimensionality_reduction:
            model: UMAP
            n_neighbors: 30
            n_components: 5
            min_dist: 0.0
            metric: cosine
            random_state: 42
          clustering:
            model: HDBSCAN
            min_cluster_size: 60
            min_samples: 30
            metric: euclidean
            cluster_selection_method: eom
            prediction_data: true
    outs:
    - path: models/bertopic_model/config.json
      hash: md5
      md5: a619d92166a7c4e3b363b4ec5564505d
      size: 398
    - path: models/bertopic_model/topic_embeddings.safetensors
      hash: md5
      md5: c1b7abc48a127c5d99615d286b92cad4
      size: 774232
    - path: models/bertopic_model/topics.json
      hash: md5
      md5: 861a9356bbaef2fed0fd995f782e1211
      size: 1531860
  predict:
    cmd: python src/job_post_topic_modelling/predict.py
    deps:
    - path: data/embeddings.npy
      hash: md5
      md5: 0180390272666730ce3b41a1df624dd8
      size: 83521664
    - path: data/texts.parquet
      hash: md5
      md5: c1add3c5a40f90d38209604b8f6c2f0e
      size: 811802
    - path: src/job_post_topic_modelling/predict.py
      hash: md5
      md5: 87ed9625ae361f3dea75b5020d3c05a0
      size: 5999
    - path: src/job_post_topic_modelling/utils/data_io.py
      hash: md5
      md5: a50681cf3a6b5f5e8715270a598f9357
      size: 952
    - path: src/job_post_topic_modelling/utils/find_project_root.py
      hash: md5
      md5: 865c2bda4ba114cec5b1b69baadf5a6f
      size: 3412
    params:
      params.yaml:
        embed:
          settings:
            show_progress_bar: true
            batch_size: 256
            device: cpu
            num_workers: 1
          model:
            embedding_model: intfloat/multilingual-e5-large-instruct
        predict:
          settings:
            top_n_words: 20
            verbose: true
          dimensionality_reduction:
            model: UMAP
            n_neighbors: 15
            n_components: 5
            min_dist: 0.0
            metric: cosine
            random_state: 42
          clustering:
            model: HDBSCAN
            min_cluster_size: 15
            min_samples: 15
            metric: euclidean
            cluster_selection_method: eom
            prediction_data: true
          vectorizer:
            model: CountVectorizer
            ngram_range:
            - 1
            - 3
            min_df: 10
            max_features: 10000
          c_TF_IDF:
            model: c_TF_IDF
            bm25_weighting: true
            reduce_frequent_words: true
          representation:
            model: KeyBERTInspired
    outs:
    - path: models/bertopic_model/config.json
      hash: md5
      md5: 8a0e79a5488a615175aa10b4690ea527
      size: 376
    - path: models/bertopic_model/topic_embeddings.safetensors
      hash: md5
      md5: c53913eb8f32bb3bbdc1b3fbafa45579
      size: 942176
    - path: models/bertopic_model/topics.json
      hash: md5
      md5: f625436e6b93e770bd887267a6fa0792
      size: 366532
  evaluate:
    cmd: python src/job_post_topic_modelling/evaluate.py
    deps:
    - path: models/bertopic_model/config.json
      hash: md5
      md5: a619d92166a7c4e3b363b4ec5564505d
      size: 398
    - path: models/bertopic_model/topic_embeddings.safetensors
      hash: md5
      md5: c1b7abc48a127c5d99615d286b92cad4
      size: 774232
    - path: models/bertopic_model/topics.json
      hash: md5
      md5: 861a9356bbaef2fed0fd995f782e1211
      size: 1531860
    - path: src/job_post_topic_modelling/evaluate.py
      hash: md5
      md5: ac686f453a67e612beea28b2058e4178
      size: 5396
    - path: src/job_post_topic_modelling/utils/data_io.py
      hash: md5
      md5: ce241e37484d0b8e4f95d941bcc936fc
      size: 1313
    - path: src/job_post_topic_modelling/utils/find_project_root.py
      hash: md5
      md5: 865c2bda4ba114cec5b1b69baadf5a6f
      size: 3412
    - path: src/job_post_topic_modelling/utils/log_html.py
      hash: md5
      md5: 5ba81ebd3ff00a9d894a98d008eef689
      size: 526
    outs:
    - path: output/topic_info.csv
      hash: md5
      md5: 7dc0bcec986f709b63ab7a43510238b2
      size: 61881
  embed:
    cmd: python src/job_post_topic_modelling/embed.py
    deps:
    - path: data/texts.parquet
      hash: md5
      md5: 9e849442e5c16a27385d5fbc14839f9e
      size: 6948540
    - path: src/job_post_topic_modelling/embed.py
      hash: md5
      md5: 4f8aeaa36080806da911eb43b0c22bb1
      size: 1995
    - path: src/job_post_topic_modelling/utils/data_io.py
      hash: md5
      md5: ce241e37484d0b8e4f95d941bcc936fc
      size: 1313
    - path: src/job_post_topic_modelling/utils/find_project_root.py
      hash: md5
      md5: 865c2bda4ba114cec5b1b69baadf5a6f
      size: 3412
    params:
      params.yaml:
        embed:
          settings:
            show_progress_bar: true
            batch_size: 256
            device: cpu
            num_workers: 1
          model:
            embedding_model:
              sentence-transformers/paraphrase-multilingual-mpnet-base-v2
            use_model2vec: false
            pca_dims: 384
    outs:
    - path: data/embeddings.npy
      hash: md5
      md5: b712c135fae1cfd48ecbb97cca9a5bf3
      size: 391907456
