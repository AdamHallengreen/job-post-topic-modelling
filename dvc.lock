schema: '2.0'
stages:
  prepare:
    cmd: python src/job_post_topic_modelling/prepare.py
    deps:
    - path: data/Jobnet.xlsx
      hash: md5
      md5: 26964e5ea3bf422d0f744b6fab9af448
      size: 13307578
    - path: src/job_post_topic_modelling/prepare.py
      hash: md5
      md5: 4adc528b5e718da950afd5d18117e73f
      size: 10507
    - path: src/job_post_topic_modelling/utils/data_io.py
      hash: md5
      md5: a50681cf3a6b5f5e8715270a598f9357
      size: 952
    - path: src/job_post_topic_modelling/utils/find_project_root.py
      hash: md5
      md5: 865c2bda4ba114cec5b1b69baadf5a6f
      size: 3412
    params:
      params.yaml:
        prepare:
          settings:
            nobs: 1000
            split_paragraphs: true
          star:
            usestar: 0
    outs:
    - path: data/texts.parquet
      hash: md5
      md5: a5586ac79d4cc2e4a34162a1891f8b41
      size: 782638
  train:
    cmd: python src/job_post_topic_modelling/train.py
    deps:
    - path: data/embeddings.npy
      hash: md5
      md5: 6c32242b052e9bdf6781fbfda0579bc1
      size: 190136448
    - path: data/texts.parquet
      hash: md5
      md5: a5586ac79d4cc2e4a34162a1891f8b41
      size: 782638
    - path: src/job_post_topic_modelling/train.py
      hash: md5
      md5: 8545577f38b69c568c256550a66ff265
      size: 6647
    - path: src/job_post_topic_modelling/utils/data_io.py
      hash: md5
      md5: a50681cf3a6b5f5e8715270a598f9357
      size: 952
    - path: src/job_post_topic_modelling/utils/find_project_root.py
      hash: md5
      md5: 865c2bda4ba114cec5b1b69baadf5a6f
      size: 3412
    params:
      params.yaml:
        embed:
          settings:
            show_progress_bar: true
            batch_size: 128
            device: cpu
            num_workers: 1
          model:
            embedding_model: GritLM/GritLM-7B
            use_model2vec: true
            pca_dims: 4096
        train:
          settings:
            top_n_words: 20
            verbose: true
          dimensionality_reduction:
            model: UMAP
            n_neighbors: 15
            n_components: 5
            min_dist: 0.0
            metric: cosine
            random_state: 42
          clustering:
            model: HDBSCAN
            min_cluster_size: 15
            min_samples: 15
            metric: euclidean
            cluster_selection_method: eom
            prediction_data: true
          vectorizer:
            model: CountVectorizer
            ngram_range:
            - 1
            - 3
            min_df: 10
            max_features: 10000
          c_TF_IDF:
            model: c_TF_IDF
            bm25_weighting: true
            reduce_frequent_words: true
          representation:
            model: KeyBERTInspired
    outs:
    - path: models/bertopic_model/config.json
      hash: md5
      md5: 8e77eddba5039e382ee3f00c0bbac28a
      size: 353
    - path: models/bertopic_model/topic_embeddings.safetensors
      hash: md5
      md5: 6bb71f44673da2605fdd8496c1730c50
      size: 2162784
    - path: models/bertopic_model/topics.json
      hash: md5
      md5: a85130e48753b8c98f80089821a0b520
      size: 203426
  predict:
    cmd: python src/job_post_topic_modelling/predict.py
    deps:
    - path: data/embeddings.npy
      hash: md5
      md5: 0180390272666730ce3b41a1df624dd8
      size: 83521664
    - path: data/texts.parquet
      hash: md5
      md5: c1add3c5a40f90d38209604b8f6c2f0e
      size: 811802
    - path: src/job_post_topic_modelling/predict.py
      hash: md5
      md5: 87ed9625ae361f3dea75b5020d3c05a0
      size: 5999
    - path: src/job_post_topic_modelling/utils/data_io.py
      hash: md5
      md5: a50681cf3a6b5f5e8715270a598f9357
      size: 952
    - path: src/job_post_topic_modelling/utils/find_project_root.py
      hash: md5
      md5: 865c2bda4ba114cec5b1b69baadf5a6f
      size: 3412
    params:
      params.yaml:
        embed:
          settings:
            show_progress_bar: true
            batch_size: 256
            device: cpu
            num_workers: 1
          model:
            embedding_model: intfloat/multilingual-e5-large-instruct
        predict:
          settings:
            top_n_words: 20
            verbose: true
          dimensionality_reduction:
            model: UMAP
            n_neighbors: 15
            n_components: 5
            min_dist: 0.0
            metric: cosine
            random_state: 42
          clustering:
            model: HDBSCAN
            min_cluster_size: 15
            min_samples: 15
            metric: euclidean
            cluster_selection_method: eom
            prediction_data: true
          vectorizer:
            model: CountVectorizer
            ngram_range:
            - 1
            - 3
            min_df: 10
            max_features: 10000
          c_TF_IDF:
            model: c_TF_IDF
            bm25_weighting: true
            reduce_frequent_words: true
          representation:
            model: KeyBERTInspired
    outs:
    - path: models/bertopic_model/config.json
      hash: md5
      md5: 8a0e79a5488a615175aa10b4690ea527
      size: 376
    - path: models/bertopic_model/topic_embeddings.safetensors
      hash: md5
      md5: c53913eb8f32bb3bbdc1b3fbafa45579
      size: 942176
    - path: models/bertopic_model/topics.json
      hash: md5
      md5: f625436e6b93e770bd887267a6fa0792
      size: 366532
  evaluate:
    cmd: python src/job_post_topic_modelling/evaluate.py
    deps:
    - path: models/bertopic_model/config.json
      hash: md5
      md5: 8e77eddba5039e382ee3f00c0bbac28a
      size: 353
    - path: models/bertopic_model/topic_embeddings.safetensors
      hash: md5
      md5: 6bb71f44673da2605fdd8496c1730c50
      size: 2162784
    - path: models/bertopic_model/topics.json
      hash: md5
      md5: a85130e48753b8c98f80089821a0b520
      size: 203426
    - path: src/job_post_topic_modelling/evaluate.py
      hash: md5
      md5: 970e99f608632618424bb2e7f05403bc
      size: 3453
    - path: src/job_post_topic_modelling/utils/data_io.py
      hash: md5
      md5: a50681cf3a6b5f5e8715270a598f9357
      size: 952
    - path: src/job_post_topic_modelling/utils/find_project_root.py
      hash: md5
      md5: 865c2bda4ba114cec5b1b69baadf5a6f
      size: 3412
    - path: src/job_post_topic_modelling/utils/log_html.py
      hash: md5
      md5: 5ba81ebd3ff00a9d894a98d008eef689
      size: 526
    outs:
    - path: output/topic_info.csv
      hash: md5
      md5: e228cf5121a84eed4dc4da05fd3f9f23
      size: 12482
  embed:
    cmd: python src/job_post_topic_modelling/embed.py
    deps:
    - path: data/texts.parquet
      hash: md5
      md5: a5586ac79d4cc2e4a34162a1891f8b41
      size: 782638
    - path: src/job_post_topic_modelling/embed.py
      hash: md5
      md5: 4cf6496b1d3a12ea01ca636bdb7fec25
      size: 2488
    - path: src/job_post_topic_modelling/utils/data_io.py
      hash: md5
      md5: a50681cf3a6b5f5e8715270a598f9357
      size: 952
    - path: src/job_post_topic_modelling/utils/find_project_root.py
      hash: md5
      md5: 865c2bda4ba114cec5b1b69baadf5a6f
      size: 3412
    params:
      params.yaml:
        embed:
          settings:
            show_progress_bar: true
            batch_size: 128
            device: cpu
            num_workers: 1
          model:
            embedding_model: GritLM/GritLM-7B
            use_model2vec: true
            pca_dims: 4096
    outs:
    - path: data/embeddings.npy
      hash: md5
      md5: 6c32242b052e9bdf6781fbfda0579bc1
      size: 190136448
