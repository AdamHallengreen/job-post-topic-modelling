schema: '2.0'
stages:
  prepare:
    cmd: python src/job_post_topic_modelling/prepare.py
    deps:
    - path: data/Jobnet.xlsx
      hash: md5
      md5: 26964e5ea3bf422d0f744b6fab9af448
      size: 13307578
    - path: src/job_post_topic_modelling/prepare.py
      hash: md5
      md5: 8e9aa533ebb6285a020852f55e95df57
      size: 10006
    - path: src/job_post_topic_modelling/utils/data_io.py
      hash: md5
      md5: 8b093d3fc6644ee7a327c88792aa8cf4
      size: 983
    - path: src/job_post_topic_modelling/utils/find_project_root.py
      hash: md5
      md5: 3e76b8271d64cd468a3e8e0da2fde4e3
      size: 3492
    params:
      params.yaml:
        prepare:
          settings:
            nobs: 1000
          star:
            usestar: 0
    outs:
    - path: data/texts.parquet
      hash: md5
      md5: c1add3c5a40f90d38209604b8f6c2f0e
      size: 811802
  train:
    cmd: python src/job_post_topic_modelling/train.py
    deps:
    - path: data/texts.parquet
      hash: md5
      md5: d11cc60341eaee7b126cda43e4d56b48
      size: 125177
    - path: src/job_post_topic_modelling/train.py
      hash: md5
      md5: aad65696f54b551359bc764aac233162
      size: 5390
    params:
      params.yaml:
        train:
          n_topics: 20
          embedding_model: all-MiniLM-L6-v2
          random_state: 42
    outs:
    - path: output/bertopic_topics.parquet
      hash: md5
      md5: 493115d7c7e346603ce8ebf9102a1d53
      size: 122877
  predict:
    cmd: python src/job_post_topic_modelling/predict.py
    deps:
    - path: data/embeddings.npy
      hash: md5
      md5: 21a65762c39fc0430906882d178165f2
      size: 83521664
    - path: data/texts.parquet
      hash: md5
      md5: c1add3c5a40f90d38209604b8f6c2f0e
      size: 811802
    - path: src/job_post_topic_modelling/predict.py
      hash: md5
      md5: b430811151123216cdb62842d161fff6
      size: 6169
    - path: src/job_post_topic_modelling/utils/data_io.py
      hash: md5
      md5: 8b093d3fc6644ee7a327c88792aa8cf4
      size: 983
    - path: src/job_post_topic_modelling/utils/find_project_root.py
      hash: md5
      md5: 3e76b8271d64cd468a3e8e0da2fde4e3
      size: 3492
    params:
      params.yaml:
        embed:
          settings:
            show_progress_bar: true
            batch_size: 128
            device: cpu
            num_workers: 4
          model:
            embedding_model: intfloat/multilingual-e5-large-instruct
        predict:
          settings:
            top_n_words: 20
            verbose: true
          dimensionality_reduction:
            model: UMAP
            n_neighbors: 15
            n_components: 5
            min_dist: 0.0
            metric: cosine
            random_state: 42
          clustering:
            model: HDBSCAN
            min_cluster_size: 15
            min_samples: 15
            metric: euclidean
            cluster_selection_method: eom
            prediction_data: true
          vectorizer:
            model: CountVectorizer
            ngram_range:
            - 1
            - 3
            min_df: 10
            max_features: 10000
          c_TF_IDF:
            model: c_TF_IDF
            bm25_weighting: true
            reduce_frequent_words: true
          representation:
            model: KeyBERTInspired
    outs:
    - path: models/bertopic_model/config.json
      hash: md5
      md5: 8a0e79a5488a615175aa10b4690ea527
      size: 376
    - path: models/bertopic_model/topic_embeddings.safetensors
      hash: md5
      md5: f08b44825fcd42b2db691ed5825dd5c9
      size: 950368
    - path: models/bertopic_model/topics.json
      hash: md5
      md5: cfd3005b0756e65d44be9d202d3f7a16
      size: 369769
  evaluate:
    cmd: python src/job_post_topic_modelling/evaluate.py
    deps:
    - path: models/bertopic_model
      hash: md5
      md5: c882ee971605be3b64d899b097692304.dir
      size: 1320614
      nfiles: 4
    - path: src/job_post_topic_modelling/evaluate.py
      hash: md5
      md5: 0b7bc2f156de1fad4b4408b0f8f9ab92
      size: 3454
    - path: src/job_post_topic_modelling/utils/data_io.py
      hash: md5
      md5: 8b093d3fc6644ee7a327c88792aa8cf4
      size: 983
    - path: src/job_post_topic_modelling/utils/find_project_root.py
      hash: md5
      md5: 3e76b8271d64cd468a3e8e0da2fde4e3
      size: 3492
    - path: src/job_post_topic_modelling/utils/log_html.py
      hash: md5
      md5: d9d99bdd47811925a943a81af29fe3db
      size: 545
    outs:
    - path: output/topic_info.csv
      hash: md5
      md5: d60fe23bd9db8136fa0f2de2b45ceaba
      size: 33742
  embed:
    cmd: python src/job_post_topic_modelling/embed.py
    deps:
    - path: data/texts.parquet
      hash: md5
      md5: c1add3c5a40f90d38209604b8f6c2f0e
      size: 811802
    - path: src/job_post_topic_modelling/embed.py
      hash: md5
      md5: e1eac2b02c965a9313f8a15f091137d2
      size: 1705
    - path: src/job_post_topic_modelling/utils/data_io.py
      hash: md5
      md5: 8b093d3fc6644ee7a327c88792aa8cf4
      size: 983
    - path: src/job_post_topic_modelling/utils/find_project_root.py
      hash: md5
      md5: 3e76b8271d64cd468a3e8e0da2fde4e3
      size: 3492
    params:
      params.yaml:
        embed:
          settings:
            show_progress_bar: true
            batch_size: 128
            device: cpu
            num_workers: 4
          model:
            embedding_model: intfloat/multilingual-e5-large-instruct
    outs:
    - path: data/embeddings.npy
      hash: md5
      md5: 21a65762c39fc0430906882d178165f2
      size: 83521664
